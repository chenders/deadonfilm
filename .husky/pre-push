#!/bin/sh

echo "Running pre-push checks..."

# Format check
echo "Checking formatting..."
npm run format:check || exit 1

# Lint
echo "Running linter..."
npm run lint || exit 1

# Type check
echo "Running type check..."
npm run type-check || exit 1

# Unit tests
echo "Running unit tests..."
npm test || exit 1

# Server format, lint and type check
echo "Checking server..."
cd server && npm run format:check && npm run lint && npm run type-check || exit 1
cd ..

# Security scan with Semgrep (if installed)
if command -v semgrep &> /dev/null; then
  echo "Running Semgrep security scan..."
  semgrep --config auto --error --quiet . || exit 1
else
  echo "Semgrep not installed, skipping security scan (install with: brew install semgrep)"
fi

echo "All pre-push checks passed!"
