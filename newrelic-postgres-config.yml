integrations:
  - name: nri-postgresql
    env:
      # PostgreSQL connection details
      HOSTNAME: db
      PORT: 5432
      USERNAME: ${POSTGRES_USER}
      PASSWORD: ${POSTGRES_PASSWORD}
      DATABASE: ${POSTGRES_DB}

      # Collection settings
      COLLECTION_LIST: '{"postgres":{"query":"SELECT * FROM pg_stat_database WHERE datname = current_database()","columns":[{"name":"db.connections","type":"gauge"},{"name":"db.commitsPerSecond","type":"rate"},{"name":"db.rollbacksPerSecond","type":"rate"}]}}'

      # SSL mode (disable for local Docker connections)
      SSLMODE: disable

      # Collect additional metrics
      COLLECT_DB_LOCK_METRICS: true
      COLLECT_BLOAT_METRICS: false

      # Timeout (in seconds)
      TIMEOUT: 10
    interval: 15s
    labels:
      env: production
      role: database
    inventory_source: config/postgresql
