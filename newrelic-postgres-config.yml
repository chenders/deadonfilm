integrations:
  - name: nri-postgresql
    env:
      # PostgreSQL connection details
      # Environment variables are read from the container's environment
      # Set in docker-compose.yml agent service environment section
      HOSTNAME: db
      PORT: 5432
      USERNAME: {{POSTGRES_USER}}
      PASSWORD: {{POSTGRES_PASSWORD}}
      DATABASE: {{POSTGRES_DB}}

      ENABLE_SSL: false
      TRUST_SERVER_CERTIFICATE: true  # Internal Docker network

      COLLECT_DB_LOCK_METRICS: true
      COLLECT_BLOAT_METRICS: true  # Monitors table/index bloat

      TIMEOUT: 10
    interval: 15s
    labels:
      env: production
      role: database
    inventory_source: config/postgresql

# PostgreSQL log forwarding to New Relic Logs
logs:
  - name: postgresql-logs
    file: /host/var/lib/docker/volumes/deadonfilm_postgres-logs/_data/postgresql-*.log
    attributes:
      service: postgresql
      env: production
      logtype: postgresql
